<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Niveles</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- HEADER -->
  <header>
    <nav>
      <div class="nav-icon">
        <a href="index.html">
          <img src="icono.png" alt="Logo" style="height:70px">
        </a>
      </div>
      <div class="nav-links">
        <a href="lista.html" class="active">Lista de Niveles</a>
        <a href="statsviewer.html">Stats Viewer</a>
      </div>
    </nav>
  </header>

  <div class="niveles-container">
    <div class="panel" id="panel-niveles"></div>
  </div>

  <script>
    const panel = document.getElementById('panel-niveles');

    fetch('niveles.csv')
      .then(r => r.text())
      .then(csv => {
        const lines = csv.trim().split('\n');
        lines.shift(); // quitar cabecera

        lines.forEach(line => {
          const cols = line.split(';');
          const url = cols[1];
          const titulo = cols[2];
          const creador = cols[3];
          const puntos = cols[4];
          const jugadores = cols[5] ? cols[5].split(',').map(j => j.trim()) : [];

          // ID de video para la miniatura
          const match = url.match(/(?:youtu\.be\/|v=)([\w-]+)/);
          const videoId = match ? match[1] : null;
          const thumbUrl = videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : '';

          const nivelDiv = document.createElement('div');
          nivelDiv.classList.add('nivel');

          // Miniatura (enlace al video)
          const thumb = document.createElement('a');
          thumb.href = url;
          thumb.target = "_blank";
          thumb.classList.add('thumb');
          thumb.style.backgroundImage = `url('${thumbUrl}')`;
          thumb.style.width = '240px';
          thumb.style.height = '135px';
          thumb.style.backgroundSize = 'cover';
          thumb.style.backgroundPosition = 'center';

          // Info del nivel
          const infoDiv = document.createElement('div');
          infoDiv.classList.add('demon-info');

          // Nombre del nivel como botón desplegable
          const tituloBtn = document.createElement('button');
          tituloBtn.textContent = titulo;
          tituloBtn.style.fontSize = '1.3em';
          tituloBtn.style.background = 'none';
          tituloBtn.style.border = 'none';
          tituloBtn.style.cursor = 'pointer';
          tituloBtn.style.padding = '0';
          tituloBtn.style.textAlign = 'left';
          tituloBtn.style.color = 'var(--color-text-accent)';

          // Contenedor de jugadores (inicialmente oculto)
          const jugadoresDiv = document.createElement('div');
          jugadoresDiv.style.display = 'none';
          jugadoresDiv.style.marginTop = '10px';
          jugadoresDiv.innerHTML = jugadores.length > 0 
            ? `<strong>Jugadores que completaron este nivel:</strong><ul>${jugadores.map(j => `<li>${j}</li>`).join('')}</ul>`
            : `<em>Nadie ha completado este nivel todavía</em>`;

          // Toggle al hacer clic en el nombre
          tituloBtn.addEventListener('click', () => {
            jugadoresDiv.style.display = jugadoresDiv.style.display === 'none' ? 'block' : 'none';
          });

          infoDiv.appendChild(tituloBtn);
          infoDiv.appendChild(jugadoresDiv);

          nivelDiv.appendChild(thumb);
          nivelDiv.appendChild(infoDiv);

          panel.appendChild(nivelDiv);
        });
      })
      .catch(err => {
        console.error("Error cargando CSV:", err);
        panel.innerHTML = "<p>Error al cargar los niveles. Revisa la ruta del CSV.</p>";
      });
  </script>
</body>
</html>


